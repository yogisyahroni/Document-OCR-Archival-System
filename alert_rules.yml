groups:
  - name: document_ocr_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(api_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "API error rate is above 10% for more than 2 minutes"
          
      - alert: QueueSizeHigh
        expr: queue_size{queue_name="document_ocr_queue"} > 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Processing queue is growing"
          description: "Document OCR queue size is above 100 items for more than 5 minutes"
          
      - alert: WorkerDown
        expr: up{job="document-ocr-workers"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "OCR worker is down"
          description: "An OCR worker has been down for more than 1 minute"
          
      - alert: APIResponseTimeHigh
        expr: histogram_quantile(0.95, http_request_duration_seconds_bucket) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API response time is high"
          description: "95th percentile of API response time is above 2 seconds"
          
      - alert: DocumentProcessingFailed
        expr: increase(document_processing_failed_total[5m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Document processing failed"
          description: "Document OCR processing has failed in the last 5 minutes"
          
      - alert: DatabaseConnectionHighLatency
        expr: histogram_quantile(0.95, database_connection_duration_seconds_bucket) > 0.5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Database connection latency is high"
          description: "95th percentile of database connection latency is above 0.5 seconds"
          
      - alert: ElasticsearchUnreachable
        expr: up{job="elasticsearch"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Elasticsearch is unreachable"
          description: "Could not connect to Elasticsearch for more than 1 minute"
          
      - alert: RedisUnreachable
        expr: up{job="redis"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Redis is unreachable"
          description: "Could not connect to Redis for more than 1 minute"
          
      - alert: StorageQuotaExceeded
        expr: storage_used_bytes / storage_quota_bytes * 100 > 90
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Storage quota exceeded"
          description: "Storage usage is above 90% of quota for more than 5 minutes"
          
      - alert: OCRProcessingTimeHigh
        expr: histogram_quantile(0.95, ocr_processing_duration_seconds_bucket) > 300
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "OCR processing time is high"
          description: "95th percentile of OCR processing time is above 300 seconds"